\SetTitle{26}{Grover's Algorithm}{Unstructured search in $\sqrt{N}$ time}{26}

\section*{Intro}
\begin{frame}{Overview}{What do we study here?}

\begin{itemize}
    \item Some search problems have \emph{structure}, which can lead to efficient methods of solving the search problem.
    \item For example, a sorted array of integers can be subject to binary search, discovering whether an integer is present in $\Theta(\log{N})$ time for an array of size~$N$.
    \item An \emph{unstructured} search problem has no such advantage.  Classically, we may have to examine each of the $N$ items in a collection to find an object of interest.
    \item Any problem in \href{https://complexityzoo.net/Complexity_Zoo:N\#np}{\CompClass{NP}} can be posed as unstructured search problem.
\end{itemize}
    
\end{frame}

\begin{frame}{Oracle for a problem in \href{https://complexityzoo.net/Complexity_Zoo:N\#np}{\CompClass{NP}}}{We search for an $x$ such that $f(x)=1$}

\TwoColumns{%
\begin{itemize}[<+->]
    \item Input $x$ of $n$ qubits.
    \item Another input is the \href{https://en.wikipedia.org/wiki/Ancilla\_bit}{ancilla} $y$.
    \item Input $x$ is copied to output.
    \item $f(x)$ is computed in polynomial time with result
    \begin{itemize}
      \item[0] if $x$ is not a solution
      \item[1] if $x$ is a solution
    \end{itemize}
    \item Our problem is to find $x\ |\ f(x)=1$.
    \item There may be multiple solutions to this problem, but we assume there is at least one.  
\end{itemize}
}{%
\begin{center}
    \begin{GateBox}{2}{3}{5}
      \visible<1->{%
      \Input{0}{$x_{1}$}
      \Input{1}{$x_{2}$}
      \Input{2}{\RVDots}
      \Input{3}{$x_{n}$}}
      \visible<2->{\Input{4}{$y$}}
      \visible<3->{\Output{0}{$x_{1}$}
      \Output{1}{$x_{2}$}
      \Output{2}{\RVDots}
      \Output{3}{$x_{n}$}}
      \visible<4->{\Output{4}{$\Xor{y}{f(x)}$}}
      \BoxLabel{Oracle}
    \end{GateBox}
\end{center}

\visible<9->{%
Any search problem, including those that are computationally challenging, can be posed in the form of such a problem.

We next consider two examples.
}
}
    
\end{frame}


\begin{frame}{Examples}{Cryptographic and an \href{https://complexityzoo.net/Complexity_Zoo:N\#npc}{\CompClass{NPC}} application}

\TwoColumns{%
\visible<1->{
\href{https://en.wikipedia.org/wiki/RSA\_(cryptosystem)}{RSA}
\begin{itemize}
    \item Consider two large primes $p$ and $q$ whose products are $r$.
    \item Let $x$ have $n$ qubits, sufficient to encode $p$ and $q$: \[n=\Theta(\log{p}+\log{q})=\Theta(\log{pq})\]
    \item Given a suitably encoded input $x=pq$, our oracle returns $1$ if  $p\times q=r$. Otherwise, $0$ is returned.
\end{itemize}}
}{%
\visible<2->{%
\href{https://en.wikipedia.org/wiki/Travelling\_salesman\_problem}{Traveling Salesperson}
\begin{itemize}
    \item Is there a tour of a given graph $G=(V,E)$ with cost (sum of weighted edges in the tour) $B$?
    \item Let $x$ have $n$ qubits, sufficient to encode a list of elements in $V$:
    \[n = \Theta(|V|\log{|V|})\]
    \item The oracle returns $1$ if the cost of $x$ is $B$.  Otherwise, $0$ is returned.
\end{itemize}
}}
\end{frame}


\begin{frame}{Some thoughts on the oracle}{Use Tofolli gates to realize combinational logic}

\TwoUnequalColumns{0.6\textwidth}{0.4\textwidth}{%
\Vskip{-3em}\begin{itemize}
    \item Recall the \NamedGate{CCNOT}  (\href{https://en.wikipedia.org/wiki/Toffoli_gate}{Tofolli}) gate is universal.
    \item The (\href{https://en.wikipedia.org/wiki/Combinational\_logic}{combinational}) logic of a one-way function $g(x)$ could be deployed in a quantum circuit.
    \item To find $w\ |\ g(w)=z$, add logic to compute:
    \begin{align*}
      f(x) &= 1\mbox{ if $g(x)=z$}\\
      & = 0\mbox{ otherwise}
    \end{align*}
    \item $f(x)$ is then the source of a \NamedGate{CNOT} gate targeting \ket{y} to produce \Xor{y}{f(x)}.
\end{itemize}
}{%
\begin{center}
    \begin{GateBox}{2}{3}{5}
      \visible<1->{%
      \Input{0}{$x_{1}$}
      \Input{1}{$x_{2}$}
      \Input{2}{\RVDots}
      \Input{3}{$x_{n}$}}
      \Input{4}{$y$}
      \Output{0}{$x_{1}$}
      \Output{1}{$x_{2}$}
      \Output{2}{\RVDots}
      \Output{3}{$x_{n}$}
      \Output{4}{$\Xor{y}{f(x)}$}
      \BoxLabel{Oracle}
    \end{GateBox}
\end{center}
}
    
\end{frame}

\section*{Oracle}

\begin{frame}{Modeling the secret value $w$}{So that we can experiment with Grover's algorithm}

\TwoUnequalColumns{0.65\textwidth}{0.35\textwidth}{%
\Vskip{-3em}\begin{itemize}
    \item We can arrange for a controlled-\NamedGate{X} gate to depend on \emph{all} of the qubits for $x$.
    \item The \href{https://qiskit.org/documentation/stubs/qiskit.circuit.QuantumCircuit.mcx.html}{\NamedGate{mcx}} gate accepts an array of control qubits.
    \item<2-> Here is an oracle that implements the secret of \Quote{1111}.  When all the $x_i$ bits are \ket{1}, the \NamedGate{CNOT} gate is applied to \ket{y}, exchanging its \ket{0} and \ket{1} amplitudes.
    \item<3-> If instead we want to trigger the change on the \ket{0} state, we need only complement the incoming qubit using an \PauliX{} gate, as shown for $x_2$ and $x_3$.  
    \item<4-> Keeping the oracle's promise, we must restore those bits after the \NamedGate{mcx} gate.  
    \item<5-> This oracle simulates \Quote{1001} as the secret.
\end{itemize}
}{%
\visible<2->{%
\begin{center}
\Vskip{-3em}\adjustbox{valign=t, width=0.9\textwidth}{\begin{quantikz}
\lstick{$x_1$} & \qw & \ctrl{1}  & \qw & \qw\\ 
\only<2>{\lstick{$x_2$} & \qw & \ctrl{1}  & \qw & \qw \\}
\only<3>{\lstick{$x_2$} & \gate{\alert<3>{X}} & \ctrl{1}  & \qw & \qw \\}
\only<4->{\lstick{$x_2$} & \gate{X} & \ctrl{1}  & \gate{\alert<4>{X}} & \qw \\}
\only<2>{\lstick{$x_3$} & \qw & \ctrl{1}  & \qw & \qw \\}
\only<3>{\lstick{$x_3$} & \gate{\alert<3>{X}} & \ctrl{1}  & \qw & \qw \\}
\only<4->{\lstick{$x_3$} & \gate{X} & \ctrl{1}  & \gate{\alert<4>{X}} & \qw \\}
\lstick{$x_4$} & \qw & \ctrl{1} & \qw & \qw \\[1em]
\lstick{$y$}   & \qw  & \targ{} & \qw & \qw\rstick{$\Xor{y}{f(x)}$} \\
\end{quantikz}}
\end{center}}
}
    
\end{frame}
\section*{Approach}
{
\def\S{\ColorOne{\ket{s}}}
\def\W{\ColorThree{\ket{w}}}
\def\R{\ColorTwo{\ket{r}}}
\begin{frame}{A useful orthogonality for this problem}{For an $n$-qubit instance, from all possible solutions to the one(s) of interest}

\TwoColumns{%
\only<1-6>{%
\Vskip{-4em}\begin{align*}
    \S &= \TensSupProd{\left(\PPlus\right)}{n} = \RootTwoN{n}\SumBV{x}{n}\ket{x} \\
    \visible<2->{\W &= \frac{1}{\sqrt{\Mag{T}}}\sum_{t \in T} \ket{t} \\}
    \visible<5->{\R &= \frac{1}{\sqrt{2^{n}-\Mag{T}}}\sum_{t \not\in T} \ket{t}}
\end{align*}
}%
}{%
\Vskip{-4em}\begin{center}
\begin{TIKZP}[scale=2]
    \visible<1->{\draw[->,thick,\RCone] (0,0) -- (15:1) node[right]{\S};} \visible<2->{\draw[->,thick,\RCthree] (0,0) -- (0,1) node[above]{\W} ;}
    \visible<5->{\draw[->,thick,\RCtwo] (0,0) -- (1,0) node[right] {\R};}
\end{TIKZP}
\end{center}}
\only<1>{We begin with the superposition of all inputs $\S=\TensSupProd{\Hadamard}{n}\left(\TensSupProd{0}{n}\right)$}%
\only<2-3>{%
Let $T=\Set{t\ |\ f(t)=1}$.   \only<3>{Measurement of \W{} obtains a solution to the problem.}
}
\only<4-5>{%
Unfortunately, \S{} and \W{} are not orthogonal:
\(
\braket{\ColorOne{s}}{\ColorThree{w}\textbf{}} = \frac{1}{\sqrt{2^{n}\Mag{T}}}\sum_{t \in T} 1\visible<5->{ \alert{\not= 0}}
\)}%
\only<5>{%

But we can construct \R{} so that it is orthogonal to \W.}
\only<6>{%
\MedSkip{}
Grover's algorithm computes vectors in the space spanned by \W{} and \R{}, starting at \S{} and moving iteratively toward \W{}. 
\MedSkip{}
Note that \W{} and \R{} are conceptual bases used to describe this space.  We cannot create either state \textit{a priori}. Starting at \S{}, we seek \W{} using Grover's algorithm.
}
\end{frame}
}


\section*{Example}

{
\def\A{\ensuremath{\ColorOne{\alpha}}}
\def\B{\ensuremath{\ColorTwo{\beta}}}
\def\S{\ColorOne{\ket{s}}}
\def\W{\ColorThree{\bra{w}}}
\def\R{\ColorTwo{\bra{r}}}
\def\RK{\ColorTwo{\ket{r}}}
\def\WK{\ColorThree{\ket{w}}}
\def\F{\ColorFour{\QState{f}}}
\begin{frame}{A two-qubit example to illustrate Grover's algorithm}{Oracle secret value $w=2$ so $f(x)=1$ only when $x=2$ (using some bras to save space)}
\TwoUnequalColumns{0.55\textwidth}{0.45\textwidth}{%
\only<1-3>{%
\begin{itemize}
    \item<1-> We begin at \S, the uniform superposition of all possible inputs.
    \item<2-> Our secret \W{} captures $x=2$.  We do not create this state:  we seek to find it.
    \item<3-> Here is \R, orthogonal to \W.
\end{itemize}
}%
\only<4>{%
\Vskip{-3em}\begin{align*}
    \visible<4->{\cos{\theta} &= \braket{\ColorOne{s}}{\ColorTwo{r}} \\
    & = \ColorOne{\RootTwoN{2}\DQB{1}{1}{1}{1}}\times\ColorTwo{\RootN{3}\CDQB{1}{1}{0}{1}}\\
    &  =\frac{\sqrt{3}}{2}\\[2em]
    \theta &= \frac{\pi}{6}
    }
\end{align*}}%
\only<5>{%
Expressing \S{} in this basis:
\begin{align*}
    \S &= \cos{\theta}\,\RK + \sin{\theta}\,\WK \\
       &= \frac{\sqrt{3}}{2}\,\RK + \frac{1}{2}\,\WK \\
       &= \ColorOne{\RootTwoN{2}\DQB{1}{1}{1}{1}}
\end{align*}
}%
\only<6-7>{%
\Vskip{-3em}\begin{itemize}
\item The first step of the algorithm reflects the current state \S{} around the horizontal axis \R{} to obtain \ColorFour{\QState{f}}.
\item This is accomplished using the familiar phase-kickback trick, which \alert<6>{flips the sign of the component \ket{x} iff $f(x)=1$}.
\item<7-> The second step reflects the current state \ColorFour{\QState{f}} around \S{} to obtain \ColorFive{\BState{d}}.
\item<7-> In this example, we obtain \W{} exactly.  Typically we must repeat the two steps of the algorithm to get close to \W.
\end{itemize}
}%
\only<8->{%
\Vskip{-3em}\begin{itemize}
    \item For the second step, we transform to the \TensSupProd{\PauliX}{2} basis so that $\S{} \mapsto \ket{00}$, simplifying reflection about \S.
    \item Applying $\TensSupProd{\Hadamard}{2}(\F)$ obtains
    \( \RootTwoN{2}\DQB{1}{-1}{1}{1} \)
    \item Sign change except \ket{00}: 
    \ColorSix{\(t=\RootTwoN{2}{\DQB{1}{1}{-1}{-1}} \)}
    \item $\TensSupProd{\Hadamard}{2}\ColorSix{(t)}$ yields $\W=\CDQB{0}{0}{1}{0}\ColorFive{=\BState{d}}$
\end{itemize}
}
}{%
\Vskip{-5em}\hskip -3em\begin{center}
\begin{TIKZP}[scale=2.4]
    \visible<1->{\draw[->,thick,\RCone] (0,0) -- (30:1) node[right]{$\S = \RootTwoN{2}\DQB{1}{1}{1}{1}$};} 
    \visible<2-6>{\draw[->,thick,\RCthree] (0,0) -- (0,1) node[above right]{$\W=\CDQB{0}{0}{1}{0}\visible<7->{\ColorFive{=\BState{d}}}$} ;}
    \visible<7->{\draw[->,thick,\RCfive] (0,0) -- (0,1) node[above right]{$\W=\CDQB{0}{0}{1}{0}\visible<7->{\ColorFive{=\BState{d}}}$} ;}
    \visible<3->{\draw[->,thick,\RCtwo] (0,0) -- (1,0) node[right] {$\R=\RootN{3}\CDQB{1}{1}{0}{1}$};}
    \visible<4->{
     \draw[->,thick] (1,0) arc (0:30:1) coordinate(zz);
     \draw (0.7,0.17) node {$\theta=\frac{\pi}{6}$};
     }
     \visible<6>{
     \draw[->,thick] (1,0) arc (0:-30:1);
     \draw (0.7,-0.17) node {$-\frac{\pi}{6}$};}
     \visible<6->{
     \draw[->,thick,\RCfour] (0,0) -- (-30:1) node[right]{$\QState{f} = \RootTwoN{2}\DQB{1}{1}{\alert<6>{-1}}{1}$};
     }
     \visible<7->{\draw[->,thick,\RCfive] (zz) arc (30:90:1);
     \draw (0.25,0.5) node {$2\times\frac{\pi}{6}$};
     }
\end{TIKZP}
\end{center}
\visible<6>{%
\Vskip{-4em}\begin{align*}
\F &= \cos(+\theta)\RK - \sin(+\theta)\WK\\
 &= \cos(-\theta)\RK + \sin(-\theta)\WK
\end{align*}}
}

\end{frame}

\subsection*{Sign change}
\begin{frame}{Step 1: Sign change on \ket{w}}{On board}

\Vskip{-3em}\begin{itemize}
    \item We use the phase-kickback trick:
    \begin{itemize}
        \item The $x$ qubits are placed in uniform superposition using \Hadamard{} gates.
        \item The $y$ qubit is initialized to $\ket{-}=\QMinus$ and stays $\ket{-}$ throughout.
    \end{itemize}
    \item Focusing only on the $x$ qubits, the prior state for this step is initially \S, but more generally, the input and output are
    \begin{align*}
      \QState{in} &=  \B \left(\SumBV{x\neq w}{N} \ket{x}\right) + \A\ket{w},\ \A,\B > 0 \\
           \F &= \B \left(\SumBV{x\neq w}{N} \ket{x}\right) - \A\ket{w}
    \end{align*}
        so that the sign changes only for \ket{w}
\end{itemize}
    
\end{frame}
\begin{frame}{Progress of $\alpha$ and $\beta$}{We want $\alpha$ to be as close to $1$ as possible}
\Vskip{-3em}    {\small\begin{align*}
      \QState{in} &=  \B \left(\SumBV{x\neq w}{N} \ket{x}\right) + \A\ket{w},\ \A,\B > 0 \\
           \F &= \B \left(\SumBV{x\neq w}{N} \ket{x}\right) - \A\ket{w}
    \end{align*}}
\begin{itemize}
    \item Initially $\A=\B=\RootN{N}$ in \S.  $\B,\A > 0$ throughout.
    \item As \A{} increases toward 1, we expect \B{} to diminish accordingly.
    \item After each iteration:
    \begin{align*}
        (N-1)\ \B^{2} &= 1 - \A^{2}\\
        \B & = \sqrt{\frac{1-\A^{2}}{N-1}}
    \end{align*}
\end{itemize}
\end{frame}

\subsection*{Diffuser}

\begin{frame}{Stage 2 (diffuser): Reflect \QState{f} about \ket{s}}{On board}

\begin{itemize}
    \item In 2D, reflection about either axis is a sign change on the other component.
    \item This generalizes to multiple dimensions \#LinearAlgebra
    \item \S{} is neither a horizontal nor veritical axis, so reflection about it seems hard.
    \item If we can map \S{} to \ket{\TensSupProd{0}{n}}, taking all other states with us, then reflection in that basis will be easy: we just change sign on all components \emph{except} \ket{\TensSupProd{0}{n}}.
    \item We know $\TensSupProd{\Hadamard}{n}\S = \TensSupProd{0}{n}$
    \item We obtain $\TensSupProd{\Hadamard}{n}\F = \DQB{z_1}{z_2}{\RVDots}{z_N}$
\end{itemize}
    
\end{frame}
\begin{frame}{Stage 2}{The steps}
\TwoColumns{%
\begin{itemize}
    \item Given $\TensSupProd{\Hadamard}{n}\F = \DQB{z_1}{z_2}{\RVDots}{z_N}$
    \item We negate all but $z_1$
    \(
    \DQB{z_1}{-z_2}{\RVDots}{-z_N}
    \)
\end{itemize}
}{%
\begin{itemize}
    \item That would require a huge gate. It is phase equivalent to negate \emph{only} $z_1$:
        \(
    \DQB{-z_1}{z_2}{\RVDots}{z_N}
    \)
    \item There is no gate to change sign on \ket{\TensSupProd{0}{n}} but we can change sign on the bottom component \ket{\TensSupProd{1}{n}}
\end{itemize}
}
\end{frame}
\begin{frame}{Accomplishing the sign change}{ket gymnastics}
\TwoColumns{%
\begin{itemize}
    \item We need to get $z_1$ to the bottom in
        \(
    \DQB{z_1}{z_2}{\RVDots}{z_N}
    \)
    \item Applying \TensSupProd{\PauliX}{n} inverts the column obtaining
      \(
    \DQB{z_N}{z_{N-1}}{\RVDots}{z_1}
    \)
\end{itemize}
}{%
\begin{itemize}
    \item We then use a multiple Control-\PauliZ{} gate to obtain 
    \(
    \DQB{z_N}{z_{N-1}}{\RVDots}{-z_1}
    \)
    \item Apply \TensSupProd{\PauliX}{n} to obtain 
    \(
    \DQB{-z_1}{z_2}{\RVDots}{z_N}
    \)
\end{itemize}
}
    
\end{frame}
\begin{frame}{Accomplishing the Control-\PauliZ}{We can build this using multiple Control-\PauliX{}}

\begin{itemize}
    \item There is no multi control \PauliZ{} gate
    \item 
See \href{https://learn.qiskit.org/course/ch-gates/basic-circuit-identities\#c-from-cnot}{here} for how to implement the multi~control~\PauliZ{} using a multi~control~\PauliX{} and some \Hadamard{} gates.
\end{itemize}
\end{frame}
}

\section*{Circuit}

\begin{frame}{Putting it together}{One iteration}

\Vskip{-4em}\begin{center}
\begin{Pixture}[width=0.97\textwidth]{26}{5bit1step.png}
\end{Pixture}
\end{center}
\begin{itemize}
    \item The secret here is \Quote{10111}.
    \item The middle section is all diffuser, and is marked as such.
    \item Why is there an \Hadamard{} gate prior to measurement on \ket{y}?
\end{itemize}
    
\end{frame}

\section*{Emulation}
\begin{frame}{Putting it together}{Three iterations}

\Vskip{-4em}\begin{center}
\begin{Pixture}[width=0.8\textwidth]{26}{3bit3step.png}
\end{Pixture}
\end{center}
\begin{itemize}
    \item The secret here is \Quote{110}.
\end{itemize}
    
\end{frame}

\begin{frame}{Playing with qiskit}{Try this}

\Vskip{-3em}
\TwoColumns{%
\begin{center}\small
    \begin{tabular}{ccr}
     \#bits & \#steps & Prob \% \\ \hline
     6 & 1 & 11 \\
     6 & 2 & 40 \\
     6 & 3 & 60 \\
     6 & 4 & 84 \\
     6 & 5 & 97 \\
     6 & 6 & 99 \\
     6 & 7 & 95 \\
     6 & 8 & 68 \\ \hline
     10 & 1 & 1 \\
     10 & 5 & 10 \\
     10 & 7 & 20 \\
    \end{tabular}
\end{center}
}{%
\begin{itemize}
    \item At 10 qubits, emulation is very slow.
    \item The time will roughly double with every qubit in emulation, but the quantum device will take no extra time, except for the extra iterations needed for Grover's algorithm.
\end{itemize}
}
\end{frame}

\section*{Actual runs}

\begin{frame}{Runs on the IBM Q}

\Vskip{-3em}\TwoColumns{%
Perfect 2-qubit problem---strange that the $\Hadamard(\ket{y})=\QOne$ state decohered, as in emulation it was solid, but results here are good enough.  This was just a single iteration.
\Vskip{-2em}\begin{center}
\begin{Pixture}[width=0.8\textwidth]{26}{2qrealc.png}
\end{Pixture} \\
\begin{Pixture}[width=0.7\textwidth]{26}{2qrealp.png}
\end{Pixture}
\end{center}
}{%
4-qubit problem, 97\% likely to see the correct result in emulation, but a mess on real hardware with 3~iterations (\texttt{lima}). Secret was \Quote{1101}.
\Vskip{-2em}\begin{center}
\begin{Pixture}[width=0.8\textwidth]{26}{4qrealc.png}
\end{Pixture} \\
\begin{Pixture}[width=0.7\textwidth]{26}{4qrealp.png}
\end{Pixture}
\end{center}
}
    
\end{frame}

{
\def\S{\ColorOne{\ket{s}}}
\def\W{\ColorThree{\ket{w}}}
\def\R{\ColorTwo{\ket{r}}}
\begin{frame}{Some notes}{Before the math}
\Vskip{-4em}\TwoUnequalColumns{0.66\textwidth}{0.33\textwidth}{%
  \TwoColumns{%
  Picture
\begin{center}
\begin{TIKZP}[scale=2]
    \visible<1->{\draw[->,thick,\RCone] (0,0) -- (15:1) node[right]{\S};}
    \draw[->,thick,\RCthree] (0,0) -- (0,1) node[above]{\W} ;
    \draw[->,thick,\RCtwo] (0,0) -- (1,0) node[right] {\R};
\end{TIKZP}
\end{center}
\ColorTwo{Oracle: Reflect about~\R{}}
\MedSkip{}
\ColorOne{Diffuser: Reflect about~\S{}}
}{%
  Circuit
  
\ColorTwo{We use phase-kickback to negate the amplitude of \W, leaving other amplitudes positive.}
\MedSkip{}
\ColorOne{Blah blah blah}

  }%
}{%
\TwoUnequalColumns{\textwidth}{0pt}{%
Math
}{%
}
}
    
\end{frame}
}

\section*{Math}
\subsection*{First iteration}

{
\def\S{\ColorOne{\ket{s}}}
\def\W{\ColorThree{\ket{w}}}
\begin{frame}{The math}{Of the first iteration}

\begin{Reasoning}
\Reason{2}{The column vector has $N$ entries, with $-1$ at entry \W}
\Reason{3}{\Hadamard(\TensSupProd{0}{n}) produces \SumBV{x}{n} \ket{x}, so we take away an extra \RootN{N}\W{} to compensate}
\Reason{4}{For step 2, we first apply \Hadamard{}}
\Reason{6}{Next we expand \ColorTwo{\Hadamard} using our formula for a general basis state such as \W}
\Reason{9}{Note that \ket{\TensSupProd{0}{n}} is contained in each of the two terms}
\Reason{11}{$R$ is the reflection of all but the \ket{\TensSupProd{0}{n}} term}
\Reason{12}{Making the summation complete again}
\Reason{15}{Collected coefficents on \ket{\TensSupProd{0}{n}}}
\Reason{16}{Applying \Hadamard{} to return to our original basis, completing step 2}
\Reason{19}{\S{} also contains \W{}}
\Reason{20}{Preparing the fraction with a common denominator}
\Reason{21}{Separately accounting for \W.  Recall $\S=\RootN{N}\SumBV{x}{n}\ket{x}$}
\Reason{22}{Simplifying}
\end{Reasoning}

\ScrollProof{1}{3}{%
   \Next{\Three}{U_{f}(\S) &=  \RootN{N}\left(-\W + \sum_{x\neq w} \ket{x}\right) \only<2-3>{ = \RootN{N}\begin{pmatrix*}[r] 1 \\  \RVDots{} \\ 1 \\ \alert<1>{-1} \\ 1 \\ \RVDots{} \\ 1 \end{pmatrix*}}\\}
    \Last{&= \Hadamard(\ket{\TensSupProd{0}{n}}) - \frac{2}{\sqrt{N}} \W}
}%
\ScrollProof{4}{8}{%
  \Next{\Four}{U_{f}(\S) &=\Hadamard(\ket{\TensSupProd{0}{n}}) - \frac{2}{\sqrt{N}} \W \\}
  \Next{\Three}{\Hadamard(U_{f}(\S)) &= \Hadamard{}(\Hadamard(\ket{\TensSupProd{0}{n}})) - \frac{2}{\sqrt{N}} \Hadamard(\W) \\}
  \Next{\Two}{ &= \ket{\TensSupProd{0}{n}} - \frac{2}{\sqrt{N}}\ \ColorTwo{\Hadamard(\W)}\\}
  \Last{&= \ket{\TensSupProd{0}{n}} -\frac{2}{\sqrt{N}} \ \ColorTwo{\RootN{N}\NHadamard{\ColorThree{w}}{n}{x}}}
}%
\ScrollProof{9}{13}{%
  \Next{\Four}{\Hadamard(U_{f}(\S)) &= \ket{\TensSupProd{0}{n}} -\frac{2}{\sqrt{N}} \ \ColorTwo{\RootN{N}\NHadamard{\ColorThree{w}}{n}{x}} \\}
  \Next{\Three}{&= \left(1-\frac{2}{N}\right)\ket{\TensSupProd{0}{n}} - \frac{2}{\sqrt{N}}\RootN{N} \sum_{x\neq \TensSupProd{0}{n}} \NegOneExp{\DotP{\ColorThree{w}}{x}} \ket{x} \\}
  \Next{\Two}{\alert<11>{R}\left(\Hadamard(U_{f}(\S))\right) &=\left(1-\frac{2}{N}\right)\ket{\TensSupProd{0}{n}} \alert<11>{+} \frac{2}{\sqrt{N}}\RootN{N} \sum_{\alert<12>{x\neq \TensSupProd{0}{n}}} \NegOneExp{\DotP{\ColorThree{w}}{x}} \ket{x} \\}
  \Last{&= \left(1-\frac{2}{N}\right)\ket{\TensSupProd{0}{n}}\alert<12>{- \frac{2}{N}\ket{\TensSupProd{0}{n}}} \alert<11>{+} \frac{2}{\sqrt{N}}\RootN{N}  \alert<12>{\NHadamard{\ColorThree{w}}{n}{x}}}
}%
\ScrollProof{14}{18}{%
 \Next{\Four}{R\left(\Hadamard(U_{f}(\S))\right) &=\left(1-\frac{2}{N}\right)\ket{\TensSupProd{0}{n}} - \frac{2}{N}\ket{\TensSupProd{0}{n}} + \frac{2}{\sqrt{N}}\RootN{N}  \NHadamard{\ColorThree{w}}{n}{x} \\}
 \Next{\Three}{&=\left(1-\frac{4}{N}\right)\ket{\TensSupProd{0}{n}}  + \frac{2}{\sqrt{N}}\RootN{N}  \NHadamard{\ColorThree{w}}{n}{x} \\}
 \Next{\Two}{\Hadamard\left(R\left(\Hadamard(U_{f}(\S))\right)\right) &=\left(1-\frac{4}{N}\right)\Hadamard\left(\ket{\TensSupProd{0}{n}}\right)  + \frac{2}{\sqrt{N}}\ \Hadamard\left(\RootN{N}  \NHadamard{\ColorThree{w}}{n}{x}\right) \\}
 \Last{&= \left(1-\frac{4}{N}\right)\S + \frac{2}{\sqrt{N}}\W = \QState{d}}
}
\ScrollProof{19}{23}{%
\Next{\Four}{\QState{d} &= \frac{N-4}{N}\S + \frac{2}{\sqrt{N}}\W \\[1em]}
\Next{\Three}{\QState{d} &= \frac{N-4}{N}\S + \frac{2\alert<20>{N}}{\alert<20>{N}\sqrt{N}}\W \\[1em]}
\Next{\Two}{&= \frac{\alert<21>{N-4}}{N}\RootN{N}\sum_{\alert<21>{x\neq w}} \ket{x} + \frac{\alert<21>{N-4}+2N}{N}\RootN{N}\W \\}
\Last{&= \frac{N-4}{N}\RootN{N}\sum_{x\neq w} \ket{x} + \frac{3N-4}{N}\RootN{N}\W}
}
    
\end{frame}
\begin{frame}{Results from the first iteration}{Steps 1 and 2}

\Vskip{-3em}\[
\QState{d}  = \ColorSix{\frac{N-4}{N}}\RootN{N}\sum_{x\neq w} \ket{x} + \ColorFour{\frac{3N-4}{N}}\RootN{N}\W \]

Recalling that $N=2^{n}$ is large
\begin{itemize}
    \item The amplitude on \W{} has increased from \RootN{N} to nearly \ColorFour{$\frac{3}{\sqrt{N}}$}.
    \item The amplitude elsewhere is slightly reduced, from \RootN{N} to \ColorSix{$\frac{N-4}{N}\RootN{N}$}.
    \item If we repeat this analysis, we see the amplitude on \W{} take on the sequence:
    \[ \frac{1}{\sqrt{N}}, \ColorFour{\frac{3}{\sqrt{N}}}, \frac{5}{\sqrt{N}}, \ldots
    \]
    \item We apparently require $\Theta(\sqrt{N})$ iterations to observe \W{} with reasonable probability for a problem of size~$N$.
    \item We show this next.
\end{itemize}
    
\end{frame}
}

\subsection*{Generally}

{
\def\D{\QState{d}}
\def\F{\QState{f}}
\def\S{\ColorOne{\ket{s}}}
\def\R{\ColorTwo{\ket{r}}}
\def\W{\ColorThree{\ket{w}}}
\def\A{\ColorFive{\ensuremath{\alpha}}}
\def\B{\ColorTwo{\ensuremath{\beta}}}

\begin{frame}{Setup}{For the math of each iteration}
\begin{itemize}
    \item Our function's inputs are $n$ bits wide, with $N=2^{n}$
    \item Our function has just one secret (special input value),  \W.
    \item \S{} is the uniform superposition of all possible function inputs:
    \[ \S = \RootN{N} \SumBV{x}{n} \ket{x} = \Hadamard\left(\TensSupProd{0}{n}\right)\]
    \item Throughout
    \begin{description}
      \item[\A] represents the amplitude on our special value \W.
    \item[\B] represents the amplitude on each of the $N-1$ other states.
    \end{description}
    \item We therefore require
    \[ \Prob{\A}  + (N-1)\,\Prob{\B} = 1\]
    \item Initially $\A=\B=\RootN{N}$, so we begin at \S.
\end{itemize}
\end{frame}

\begin{frame}{The math}{Generally, with $\alpha$ amplitude on \ket{w} and $\beta$ amplitude on all other values}

\begin{Reasoning}
\Reason{1}{Prior to step 1, we have \A{} amplitude on \W, and \B{} amplitude on all other states}
\Reason{2}{The oracle $U_{f}$ reflects amplitude on \W, leaving all others alone}
\Reason{3}{Completing the sum}
\Reason{4}{\Hadamard(\TensSupProd{0}{n}) = \RootN{N}\SumBV{x}{n}\ket{x}}
\Reason{6}{Collect terms in preparation for the upcoming \Hadamard{}}
\Reason{7}{Collect the coefficients for \W}
\Reason{8}{Apply \Hadamard{} to both sides}
\Reason{9}{\Hadamard{} is its own inverse}
\Reason{12}{Recall $\Hadamard\left(\W\right) = \RootN{N} \NHadamard{\ColorThree{w}}{n}{x}$}
\Reason{13}{Rearrange. Note that \ket{\TensSupProd{0}{n}} appears in the summation}
\Reason{14}{Collect coefficients for \ket{\TensSupProd{0}{n}}. $\B\,\sqrt{N}-\B\RootN{N} - \A\RootN{N}=\RootUN{\B(N-1)-\A}{N}$}
\Reason{16}{We next negate all states except \ket{\TensSupProd{0}{n}}}
\Reason{17}{We denote the reflection of all states except \ket{\TensSupProd{0}{n}} using $R$}
\Reason{18}{Complete the summation}
\Reason{19}{We next collect coefficients of \ket{\TensSupProd{0}{n}}}
\Reason{21}{Collected coefficients of \ket{\TensSupProd{0}{n}}}
\Reason{22}{Preparing for last \Hadamard}
\Reason{24}{Final \Hadamard, returning to the $\R\times\W$ basis}
\Reason{25}{Recall $\S{}=\Hadamard\left(\ket{\TensSupProd{0}{n}}\right)$ and $\RootN{N}\Hadamard\left(\NHadamard{\ColorThree{w}}{n}{x}\right)=\W$}
\Reason{27}{\S{} includes \W{}.  We next combine amplitudes for \W}
\end{Reasoning}

\ScrollProof{1}{5}{%
    \Next{\Four}{\D &= +\A\W +  \B\sum_{\AllBits{x}{n},\ x\neq w} \ket{x}\\}
    \Next{\Three}{\F = U_{f}(\D) &= -\A\W + \B \sum_{\AllBits{x}{n},\ x\neq w} \ket{x}\\}
   \Next{\Two}{ &=  -\A\W + \B\left(-\W +  \SumBV{x}{n}\ket{x}\right) \\}
    \Last{&=  -\A\W + \B\left(-\W +  \sqrt{N}\ \Hadamard\left(\ket{\TensSupProd{0}{n}}\right)\right)}
}%
\ScrollProof{6}{10}{%
  \Next{\Four}{\F &=  -\A\W + \B\left(-\W +  \sqrt{N}\ \Hadamard\left(\ket{\TensSupProd{0}{n}}\right)\right) \\}
  \Next{\Three}{ &= \left(-\A-\B\right)\W + \B\sqrt{N}\  \Hadamard\left(\ket{\TensSupProd{0}{n}}\right)\\}
  \Next{\Two}{\alert<8>{\Hadamard}(\F) &= \left(-\A-\B\right)\alert<8>{\Hadamard}\left(\W\right) + \B\sqrt{N}\  \ \alert<9>{\alert<8>{\Hadamard}\left(\Hadamard\left(\ket{\TensSupProd{0}{n}}\right)\right)}\\}
  \Last{&=\left(-\A-\B\right)\Hadamard\left(\W\right) + \B\,\sqrt{N}\, \alert<9>{\ket{\TensSupProd{0}{n}}}}
}%
\ScrollProof{11}{15}{%
  \Next{\Four}{\Hadamard(\F)&=\left(-\A-\B\right)\alert<12>{\Hadamard\left(\W\right)} + \B\,\sqrt{N}\, \ket{\TensSupProd{0}{n}} \\}
%%
  \Next{\Three}{ &= \left(-\A-\B\right)\alert<12>{\RootN{N}\NHadamard{\ColorThree{w}}{n}{x}} + \B\,\sqrt{N}\, \ket{\TensSupProd{0}{n}}\\}
  \Next{\Two}{ &= \B\,\sqrt{N}\, \ket{\TensSupProd{0}{n}} - \left(\A+\B\right)\alert<12>{\RootN{N}\alert<13>{\NHadamard{\ColorThree{w}}{n}{x}}}\\}
  \Last{&= \left(\RootUN{\B(N-1)-\A}{N}\right) \ket{\TensSupProd{0}{n}} - \left(\A+\B\right)\RootN{N}\NHadamardS{\ColorThree{w}}{n}{x}{\sum_{\alert<14>{x\neq\TensSupProd{0}{n}}}}}
}%
\ScrollProof{16}{19}{%
 \Next{\Three}{\Hadamard(\F) &=\left(\RootUN{\B(N-1)-\A}{N}\right) \ket{\TensSupProd{0}{n}} \alert<17>{-} \RootUN{\A+\B}{N}\NHadamardS{\ColorThree{w}}{n}{x}{\sum_{\alert<14>{x\neq\TensSupProd{0}{n}}}} \\}
 \Next{\Two}{\alert<17>{R}\left(\Hadamard(\F)\right) &=\left(\RootUN{\B(N-1)-\A}{N}\right) \ket{\TensSupProd{0}{n}} \alert<17>{+} \RootUN{\A+\B}{N}\NHadamardS{\ColorThree{w}}{n}{x}{\sum_{\alert<14>{\alert<18>{x\neq\TensSupProd{0}{n}}}}}  \\}
 %% left off here
 \Last{ &=\left(\RootUN{\B(N-1)-\A}{N}\right) \ket{\TensSupProd{0}{n}} \alert<17>{+} \RootUN{\A+\B}{N}\NHadamardS{\ColorThree{w}}{n}{x}{\sum_{\alert<14>{\alert<18>{\AllBits{x}{n}}}}}\\ & \hbox to 11em{\hss} \alert<18>{- \RootUN{\A+\B}{N}\ket{\TensSupProd{0}{n}}}
}}%
\ScrollProof{20}{22}{%
  \Next{\Two}{R\left(\Hadamard(\F)\right) &= \left(\RootUN{\B(N-1)-\A}{N}\right) \ket{\TensSupProd{0}{n}} + \RootUN{\A+\B}{N}\NHadamardS{\ColorThree{w}}{n}{x}{\sum_{\AllBits{x}{n}}}\\ & \hbox to 11em{\hss} - \RootUN{\A+\B}{N}\ket{\TensSupProd{0}{n}} \\[1em]}
  \Last{ &= \left(\RootUN{\B\,(N-2)-2\A}{N}\right) \ket{\TensSupProd{0}{n}} +\RootUN{\A+\B}{N}\NHadamard{\ColorThree{w}}{n}{x}}
}
\ScrollProof{23}{26}{%
  \Next{\Three}{R\left(\Hadamard(\F)\right) &=\left(\RootUN{\B\,(N-2)-2\A}{N}\right) \ket{\TensSupProd{0}{n}} +\RootUN{\A+\B}{N}\NHadamard{\ColorThree{w}}{n}{x} \\}
  \Next{\Two}{\alert<24>{\Hadamard}\left(R\left(\Hadamard(\F)\right)\right) &=\left(\RootUN{\B\,(N-2)-2\A}{N}\right) \alert<24>{\Hadamard}\left(\ket{\TensSupProd{0}{n}}\right) \\& \hbox to 12em{\hss}+\RootUN{\A+\B}{N}\alert<24>{\Hadamard}\left(\NHadamard{\ColorThree{w}}{n}{x}\right) \\}
  \Last{ &= \RootUN{\B\,(N-2)-2\A}{N}\S+\left(\A+\B\right)\W=\D }
}%
\ScrollProof{27}{30}{%
\Next{\Three}{\D &= \RootUN{\B\,(N-2)-2\A}{N}\S+\left(\A+\B\right)\W \\}
\Next{\Two}{ &=  \RootUN{\B\,(N-2)-2\A}{N}\RootN{N}\SumBV{x}{n} \ket{x} + \left(\A+\B\right)\W \\}
\Last{ &=  \frac{\B\,(N-2)-2\A}{N}\SumBV{x}{n} \ket{x} + \left(\A+\B\right)\W}
}
\ScrollProof{31}{35}{%
\Next{\Four}{\D  &=  \frac{\B\,(N-2)-2\A}{N}\SumBV{x}{n} \ket{x} + \left(\A+\B\right)\W \\}
\Next{\Three}{ &=  \frac{\B\,(N-2)-2\A}{N}\hbox to -1em{\hss}\sum_{\AllBits{x}{n},\ x\neq w} \hbox to -2em{\hss}\ket{x} + \left(\A+\B\right)\W +\frac{\B\,(N-2)-2\A}{N}\W \\}
\Next{\Two}{& = \frac{\B\,(N-2)-2\A}{N}\hbox to -1em{\hss}\sum_{\AllBits{x}{n},\ x\neq w} \hbox to -2em{\hss}\ket{x} + \frac{N(2\B+\A)-2(\A+\B)}{N}\W \\}
\Last{&=  \left(\B\,\left(1-\frac{2}{N}\right)-\frac{2\A}{N}\right)\hbox to -1em{\hss}\sum_{\AllBits{x}{n},\ x\neq w} \hbox to -2em{\hss}\ket{x} + \left((2\B+\A)-\frac{2}{N}(\A+\B)\right)\W}
}
\end{frame}
\begin{frame}{The math}{Conclusion}
\begin{align*}
\D &=  \left(\B\,\left(1-\frac{2}{N}\right)-\frac{2\A}{N}\right)\hbox to -1em{\hss}\sum_{\AllBits{x}{n},\ x\neq w} \hbox to -2em{\hss}\ket{x} + \left((2\B+\A)-\frac{2}{N}(\A+\B)\right)\W \\
&\approx\  \B\hbox to -1em{\hss}\sum_{\AllBits{x}{n},\ x\neq w} \hbox to -2em{\hss}\ket{x} + (2\B+\A)\W\mbox{, assuming $N$ is large compared to \A{} and \B}
\end{align*}
\visible<2->{%
\begin{itemize}
    \item Initially, $\A=\B=\RootN{N}$.
    \item Each iteration
    \begin{itemize}
      \item The amplitude for \W{} at the start of each iteration is \[\RootUN{1}{N}, \RootUN{3}{N}, \RootUN{5}{N},\ldots\]
      \item The amplitude for all other \ket{x} becomes slightly smaller.
    \end{itemize}
\end{itemize}
}
\end{frame}

}

\begin{frame}{To do}{The math of iterations needed}
    
\end{frame}