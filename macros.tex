\usepackage{blkarray}
\usepackage{mathtools}
\usepackage{lmodern}
\usepackage{fancybox}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{tikz-3dplot}
\usepackage{adjustbox}
\usetikzlibrary{quantikz}
\usepackage{xcolor}
\usepackage{bm}
\pgfplotsset{compat=newest}
\logo{%
\stackbox[c][c]{\includegraphics[height=1.15cm]{logo.pdf}\\[-3pt]{\textcopyright~2022-23}\\{Ron K. Cytron}}}

% \logo{\includegraphics[height=2.5cm]{logo.pdf}}
\def\ColorR#1{\textcolor{BrickRed}{#1}}
\def\ColorG#1{\textcolor{\RCthree}{#1}}
\def\ColorB#1{\textcolor{\RCtwo}{#1}}
\definecolor{links}{HTML}{2E8B57}
\hypersetup{colorlinks,linkcolor=,urlcolor=links}
%%
%% From stackoverflow
%%
\newcommand{\MyArrow}[1][0.1pt]{\tikz[baseline=-0.26em,y=3em, x=3em]{\filldraw[line width=#1] (0.4202,0.0021) .. controls (0.4202,-0.0000) and (0.4188,-0.0018) .. (0.4171,-0.0025) .. controls (0.3917,-0.0092) and (0.3699,-0.0236) .. (0.3509,-0.0401) .. controls (0.3355,-0.0538) and (0.3225,-0.0704) .. (0.3130,-0.0890) .. controls (0.3119,-0.0915) and (0.3094,-0.0929) .. (0.3066,-0.0929) .. controls (0.3028,-0.0929) and (0.2996,-0.0897) .. (0.2996,-0.0858) .. controls (0.2996,-0.0848) and (0.3000,-0.0837) .. (0.3003,-0.0827) .. controls (0.3087,-0.0665) and (0.3193,-0.0517) .. (0.3316,-0.0391) -- (0.1181,-0.0391) .. controls (0.1143,-0.0391) and (0.1111,-0.0359) .. (0.1111,-0.0320) .. controls (0.1111,-0.0282) and (0.1143,-0.0250) .. (0.1181,-0.0250) -- (0.3471,-0.0250) .. controls (0.3611,-0.0137) and (0.3766,-0.0046) .. (0.3935,0.0021) .. controls (0.3766,0.0088) and (0.3611,0.0179) .. (0.3471,0.0292) -- (0.1181,0.0292) .. controls (0.1143,0.0292) and (0.1111,0.0323) .. (0.1111,0.0362) .. controls (0.1111,0.0401) and (0.1143,0.0432) .. (0.1181,0.0432) -- (0.3316,0.0432) .. controls (0.3193,0.0559) and (0.3087,0.0707) .. (0.3003,0.0868) .. controls (0.3000,0.0879) and (0.2996,0.0889) .. (0.2996,0.0900) .. controls (0.2996,0.0939) and (0.3028,0.0970) .. (0.3066,0.0970) .. controls (0.3094,0.0970) and (0.3119,0.0956) .. (0.3130,0.0932) .. controls (0.3225,0.0745) and (0.3355,0.0580) .. (0.3509,0.0443) .. controls (0.3699,0.0278) and (0.3917,0.0133) .. (0.4171,0.0067) .. controls (0.4188,0.0059) and (0.4202,0.0042) .. (0.4202,0.0021) -- cycle;}}
\def\LinkArrow#1{%
\mbox{$\,$\href{#1}{\mbox{\vrule width 0pt height 0ex depth 0pt$\MyArrow[0.75pt]$}}}$\,$}
\def\WLOG{WLOG}
\def\True{\mbox{\texttt{True}}}
\def\False{\mbox{\texttt{False}}}
\def\Zero{\mbox{$0$}}
\def\One{\mbox{$1$}}
\def\Not#1{%
\ensuremath{\Overline{\ensuremath{#1}}}}
\def\Xor#1#2{\ensuremath{#1\oplus #2}}
\def\Nand#1#2{%
\ensuremath{\mbox{Nand}(#1,#2)}}
\def\And#1#2{%
\ensuremath{#1 \wedge #2}}
\def\Or#1#2{%
\ensuremath{#1 \vee #2}}
\def\Conj#1{%
\ensuremath{#1^{\star}}}
\def\Star#1{%
\Conj{#1}}
\def\EmptyString{\ensuremath{\lambda}}
\def\Mag#1{%
\ensuremath{{|\,#1\,|}}}
\def\PNorm#1#2{\ensuremath{\Mag{\kern-2pt\Mag{#1}\kern-2pt}}_{#2}}
\def\Prob#1{%
\ensuremath{\Mag{#1}^{2}}}
\def\CNOT#1#2{%
\ensuremath{\NamedGate{CNOT}(#1,#2)}}
\def\CNOTMatrix{%
\ensuremath{\begin{pmatrix*}[r]
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 \\
0 & 0 & 0 & 1 \\
0 & 0 & 1 & 0\end{pmatrix*}}%
}
\def\CCNOT#1#2#3{%
\ensuremath{\mbox{\NamedGate{CNOT}}(#1,#2,#3)}}
\long\def\ToDo#1{\smash{\textcolor{YellowOrange}{#1}}}
\def\ApplyGate#1#2{%
\ensuremath{#1\,#2}}
\def\Inverse#1{\ensuremath{{#1}^{-1}}}
\def\Quote#1{``#1''}
\def\NamedGate#1{%
\mbox{\bfseries{\textrm{#1}}}}
\def\NamedBasis#1{\NamedGate{#1}}
\def\Identity{\NamedGate{I}}
\def\Hadamard{\NamedGate{H}}
\def\CCNOT{\NamedGate{CCNOT}}
\def\PauliX{\NamedGate{X}}
\def\PauliY{\NamedGate{Y}}
\def\PauliZ{\NamedGate{Z}}
\def\SQBG#1#2#3#4#5{%
\ensuremath{%
#1 \begin{pmatrix*}[r] #2 & #3 \\ #4 & #5\end{pmatrix*}}}
\def\HMatrix{%
\SQBG{\RootTwo{}}{1}{1}{1}{-1}}
\def\XMatrix{%
\SQBG{\relax}{0}{1}{1}{0}}
\def\ZMatrix{%
\SQBG{\relax}{1}{0}{0}{-1}}
\def\YMatrix{%
\SQBG{\relax}{0}{-\NiceI}{\NiceI}{0}}
\def\IMatrix{%
\SQBG{\relax}{1}{0}{0}{1}}
\def\Co#1{\mathbb{C}}
\def\Implies#1#2{\ensuremath{#1 \rightarrow\ #2}}
\def\Domain#1{\ensuremath{\mathcal{#1}}}
\def\CompClass#1{\Domain{#1}}
\def\SpecialX#1{\ensuremath{#1^{\star}}}
\def\Forall#1#2{\ensuremath{\forall\ #1, #2}}
\def\Degrees#1{\ensuremath{#1^{\circ}}}
\def\RootN#1{\RootUN{1}{#1}}
\def\RootUN#1#2{\ensuremath{\frac{#1}{\sqrt{#2}}}}
\def\RootTwo{\RootN{2}}
\def\TwoSupOp#1#2#3{%
\ensuremath{\RootTwo{}\left(#1 #3 #2\right)}}
\def\TwoSup#1#2{%
   \TwoSupOp{\ket{#1}}{\ket{#2}}{+}}
\def\QPlus{\TwoSupOp{\QZero}{\QOne}{+}}
\def\QMinus{\TwoSupOp{\QZero}{\QOne}{-}}
\def\Set#1{\ensuremath{\left\{\,#1\,\right\}}}
\def\BigSkip{%

\bigskip

}

\def\MedSkip{%

\medskip

}
\def\SmallSkip{%

\smallskip

}
\def\SineWave#1{%
{%
\pgfmathsetmacro{\Xone}{#1}
\pgfmathsetmacro{\Xtwo}{-(#1)}
\draw (0,0) sin(1,\Xone) cos (2,0) sin(3,\Xtwo) cos (4,0);
}
}
\newcommand{\tolstrut}{%
  \vrule height\dimexpr\fontcharht\font`\A+.1ex\relax width 0pt\relax
}

\DeclareRobustCommand{\Overline}[1]{%
  \ensuremath{\overline{\raisebox{0pt}[1.07\height]{#1}}}%
}
\newenvironment{TIKZP}[1][scale=1.0]{%
\adjustbox{valign=t}\bgroup
\begin{tikzpicture}[#1]
}{%
\end{tikzpicture}
\egroup
}
\long\def\Definition#1{%
\begin{block}{Definition}
#1
\end{block}}
\long\def\Postulate#1#2{%
\begin{block}{Postulate}
\begin{description} \item[#1] #2\end{description}
\end{block}}
\long\def\TwoUnequalColumns#1#2#3#4{%
\begin{columns}%
\begin{column}{#1}#3\end{column}%
\begin{column}{#2}#4\end{column}%
\end{columns}%
}
\long\def\ThreeUnequalColumns#1#2#3#4#5#6{%
\begin{columns}%
\begin{column}{#1}#4\end{column}%
\begin{column}{#2}#5\end{column}%
\begin{column}{#3}#6\end{column}%
\end{columns}%
}
\long\def\ThreeColumns#1#2#3{%
\ThreeUnequalColumns{0.33\textwidth}{0.33\textwidth}{0.33\textwidth}{#1}{#2}{#3}%
}
\long\def\TwoColumns#1#2{%
\TwoUnequalColumns{0.5\textwidth}{0.5\textwidth}{#1}{#2}%
}
\long\def\OnlyRemark#1#2{%
\only<#1>{\Remark{#2}}}

\long\def\Remark#1{%
\begin{block}{Remark}
#1
\end{block}}
\long\def\Example#1{%
\begin{example} #1\end{example}}
\def\VV{\textit{vice versa}}
\def\QZero{\ket{\hbox to 0.7em{\hss \ensuremath{0}\hss}}}
\def\QOne{\ket{\hbox to 0.7em{\hss \ensuremath{1}\hss}}}
\def\QState#1{\ket{\QName{#1}}}
\def\BState#1{\bra{\QName{#1}}}
\def\QName#1{\ensuremath{\psi_{#1}}}
\def\TensOp{\ensuremath{\bm{\otimes}}}
\def\TensProd#1#2{\ensuremath{#1 \TensOp{} #2}}
\def\TensSupProd#1#2{\ensuremath{#1^{\bm{\otimes} #2}}}
\def\PZero{\SQB{1}{0}}
\def\POne{\SQB{0}{1}}
\def\PPlus{\ensuremath{\RootTwo{}\SQB{1}{1}}}
\def\PMinus{\ensuremath{\RootTwo{}\SQB{1}{-1}}}
\def\PHad{\ensuremath\frac{1}{\sqrt{2}}\SQB{1}{1}}
\def\PHadm{\ensuremath\frac{1}{\sqrt{2}}\SQB{1}{-1}}
\def\Intersect#1#2{\ensuremath{#1 \cap #2}}
\def\Union#1#2{\ensuremath{#1 \cup #2}}
\def\Set#1{\ensuremath{\left\{\,#1\,\right\}}}
\def\BinAlph#1{\ensuremath{\Set{0,1}^{#1}}}
\def\AllBits#1#2{\ensuremath{#1\in \BinAlph{#2}}}
\def\DQB#1#2#3#4{%
\ensuremath{\begin{pmatrix*}[r] #1 \\ #2 \\ #3 \\ #4\end{pmatrix*}}}
\def\QQB#1#2#3#4#5#6#7#8{%
\ensuremath{\begin{pmatrix*}[r] #1 \\ #2 \\ #3 \\ #4 \\ #5 \\ #6 \\ #7 \\ #8\end{pmatrix*}}}
\def\SQB#1#2{%
\ensuremath{\begin{pmatrix*}[r] #1 \\ #2\end{pmatrix*}}}
\def\CQB#1#2{%
\ensuremath{\begin{pmatrix*}[r] #1\, #2\end{pmatrix*}}}
\def\CDQB#1#2#3#4{%
\ensuremath{\begin{pmatrix*}[r] #1 \, #2 \,#3 \, #4\end{pmatrix*}}}
\def\TZPointDiam{2pt}
\def\TZPoint#1#2#3{%
\draw[fill=black] (#1) circle (\TZPointDiam) node[#3] {#2} ;}
\def\UnitComplexCircle{%
\draw [<->] (-1.5, 0) -- (1.5, 0)  node[right] {$\Re{}$} ;
   \draw [<->] (0,-1.5) -- (0, 1.5) node[above] {$\Im{}$} ;

   \draw (0, 0) circle (1) ;
   }
   \def\TZPEast{\TZPoint{1,0}{$+1$}{above right}}
   \def\TZPNorth{\TZPoint{0,1}{$\NiceI{}$}{above right}}
   \def\TZPWest{\TZPoint{-1,0}{$-1$}{above left}}
   \def\TZPSouth{\TZPoint{0,-1}{$-\NiceI{}$}{below right}}
\def\TZText#1#2#3{%
  \draw (#1) node [#3] {#2};
}
\def\Qiskit{\texttt{qiskit}}
\def\TwoToThe#1{\ensuremath{2^{#1}}}
\def\Exp#1{\ensuremath{e^{#1}}}
\def\NiceI{\kern 0.5pt\ensuremath{\mathfrak{i}}}
\def\ExpPhase#1{\Exp{\,\NiceI\,#1}}
\def\ExpNegPhase#1{\Exp{-\NiceI\,#1}}
%%
%% Not sure this is used
%%
\def\PhaseLabel#1{\phase{\fbox{#1}}}
%%
\def\ColHead#1{\begin{center}\bf #1\end{center}}
\def\Complex#1#2{\ComplexGen{#1}{#2}{+}}
\def\ComplexDiff#1#2{\ComplexGen{#1}{#2}{-}}
\def\ImaginaryM#1{\ComplexDiff{\relax}{#1}}
\def\ComplexGen#1#2#3{%
\ensuremath{#1 #3 \NiceI\relax #2}}
\def\Polar#1#2{\ensuremath{#1\hbox to 0.1pt{\hss}\ExpPhase{#2}}}
%%
%% #1 -- lower left x
%% #2 -- lower left y
%% #3 -- upper right x
%% #4 -- upper right y
%% #5 -- num lines
\def\PFilter#1#2#3#4#5{

    \draw (#1,#2) -- (#3,#2) -- (#3,#4) -- (#1,#4) -- cycle;
    \foreach \i in {1,...,#5}
    {
        \pgfmathsetmacro{\PFilterInc}{#1 + (#3-#1) / #5 * \i}
        % \edef\PFilterInc{\pgfmathresult}
        \draw (\PFilterInc, #2) -- (\PFilterInc, #4);
    }
}
%% #1 - x
%% #2 - y
%% #3 - degrees
%% #4 - options
%% #5 - radius
\def\RadiantArrowsR#1#2#3{%
\foreach \p in {0, #1,...,360} {
   \draw[#2] (0,0)  -- (\p:#3) ;
}
}
\def\RadiantArrows#1#2{%
   \RadiantArrowsR{#1}{#2}{1}
}
\newcommand\RotateTheta[1][scale=1.0]{%
\SquareOutline{}
\begin{scope}[#1]
\fill[white] (0.5,0.5) circle (0.5);
\draw (0.5,0.5) circle (0.5);
\draw[->] (1.0,0.5) arc(0:45:0.5);
\draw (0.5,0.5) node {$\theta$};
\end{scope}
}
\def\SquareOutline{%
\path (0,0) rectangle (1,1);%
}%
\newcommand\Qif[1][scale=1.0]{%
\begin{scope}[#1]
\SquareOutline{}
\clip (0,0) rectangle(1,1);
\RotateAroundCenter{45}{%
\begin{scope}
\draw (0.15,0.15) rectangle(0.85,0.85);
\end{scope}}
\end{scope}
}
\newcommand\LightSource[1][scale=1.0]{%
\begin{scope}[#1]
\SquareOutline{}
\PhotonGun{}
\begin{scope}[shift={(0.75,0.5)}]
    \RadiantArrowsR{22.5}{color=red}{0.25}
\end{scope}
\end{scope}
}
\def\PhotonGun{%
\fill (0,0.375) rectangle (0.5, 0.625);
}
\def\HPolar{%
\begin{scope}[color=red]
\SquareOutline{}
\draw[thick] (0.5,0.4) -- ++(0.35,0)
             ++(-0.35,0.1) -- ++(0.35,0)
             ++(-0.35,0.1) -- ++(0.35,0);
% \fill (0.90,0.5) circle (0.05);
\end{scope}
}
\def\VPolar{%
\begin{scope}[color=red]
\draw[thick] (0.6,0.375) -- ++(0,.250)
             ++(0.1,-.250) -- ++(0,.250)
             ++(0.1,-.250) -- ++(0,.250);
% \fill (0.95,0.5) circle (0.05);
\end{scope}
}
\newcommand\HPolarizedLightSource[1][scale=1.0]{%
\begin{scope}[#1]
\SquareOutline{}
\PhotonGun{}
\HPolar{}
\end{scope}
}
\newcommand\VPolarizedLightSource[1][scale=1.0]{%
\begin{scope}[#1]
\SquareOutline{}
\PhotonGun{}
\VPolar{}
\end{scope}
}
\newcommand\EVBomb[1][scale=1.0]{%
\begin{scope}[#1]
\fill (0.5,0.5) circle(0.5);
\end{scope}%
}
\newcommand\EVBoom[1][scale=1.0]{%
\begin{scope}[#1]
\fill[white] (0.5,0.5) circle(0.5);
\draw[red,thick] (0.5,0.5) circle(0.5);
\clip (0,0) rectangle(1,1);
\begin{scope}
\node[scale=0.35,xshift=28pt,yshift=28pt,starburst,draw,red,fill=orange,line width=1.5pt]
{BOOM!};
\end{scope}
\end{scope}
}
\newcommand\Measurement[1][scale=1.0]{%
\begin{scope}[#1]
\draw[color=white] (0,0) rectangle(1,1);
\begin{scope}
\clip (0.25,0.25) rectangle (1,1);
\draw (0,0) circle(0.9);
\draw (0,0) circle(1.0);
\end{scope}
\draw[thick] (0,0) --(0,1);
\draw[->] (0.25,0.25) -- (0.9,0.9);
\end{scope}
}
\def\TRectangle#1#2#3#4#5#6{%
\begin{scope}[#6]
\draw [fill=#5] (#1,#2) rectangle (#3,#4);
\end{scope}
}
%% #1 -- llx
%% #2 -- lly
%% #3 -- urx
%% #4 -- ury
%% #5 -- angle
\newcommand\Mirror[1][rotate=0]{%
\clip (0,0) rectangle(1,1);
\begin{scope}[#1]
   \SquareOutline{}
   \TRectangle{0}{.4375}{1}{.5625}{Gray}{rotate=0}
\end{scope}
}
\newcommand\BeamSplitter[1][scale=1.0]{%
\begin{scope}[#1]
    \SquareOutline{}
    \TRectangle{0}{.375}{1}{.625}{SkyBlue}{rotate=0}
\end{scope}
}
\def\MZ{%
\LightSource{}
\Shift{2}{0}{\RotateAroundCenter{-45}{\BeamSplitter{}}}
\Shift{2}{-2}{\RotateAroundCenter{-45}{\Mirror{}}}
\Shift{6}{0}{\RotateAroundCenter{-45}{\Mirror{}}}
\Shift{6}{-2}{\RotateAroundCenter{-45}{\BeamSplitter{}}}
\Shift{8}{-2}{\Measurement[color=\RCone]{}}
\Shift{6}{-4}{\RotateAroundCenter{-90}{\Measurement[color=\RCtwo]{}}}
}
\def\Shift#1#2#3{%
\begin{scope}[shift={(#1,#2)}] #3\end{scope}
}
\def\RotateAroundCenter#1#2{%
\begin{scope}[rotate around={#1:(0.5,0.5)}]
  #2
\end{scope}
}
\def\Vskip#1{\mbox{}\vskip #1\mbox{}}
\def\Hskip#1{\mbox{}\hskip #1\mbox{}}
\author{Ron K.~Cytron}
\institute{Washington University\\Saint Louis, Missouri\\[2em] \textcopyright~2022-23 All rights reserved by the author}
\setbeamertemplate{footline}[frame number]{}
%\setbeamertemplate{footline}[text line]{%
%  \parbox{\linewidth}{\vspace*{-8pt}\textcopyright~2021\hfill\insertshortauthor\hfill\insertpagenumber}}
%% #1 -- lecture number
%% #2 -- lecture title
%% #3 -- lecture subtitle
%% #4 -- lecture label
\def\SetTitle#1#2#3#4{%
   \title{#2}%
   \subtitle{#3}%
   \date{\today}%
   %\begin{frame}\maketitle\end{frame}%
   \frame{\titlepage}%
   \lecture[#1]{#2: #3}{lec:#4}%
}
\def\Kaye{\href{https://dl.acm.org/doi/10.5555/1206629}{Kaye}}
\def\MikeIke{\href{https://dl.acm.org/doi/10.5555/1972505}{Nielson~and~Chuang}}

\newcounter{ProtocolDialogStep}
\newenvironment{ProtocolDialog}[3]{%
\def\Incr{\stepcounter{ProtocolDialogStep}}
\def\Ref##1{\Incr{}\ThreeUnequalColumns{#1}{#2}{#3}{\arabic{ProtocolDialogStep}. ##1}{\relax}{\relax}}%
\def\Alice##1{\Incr{}\ThreeUnequalColumns{#1}{#2}{#3}{\relax}{\arabic{ProtocolDialogStep}. ##1}{\relax}}%
\def\AliceBob##1##2{\All{}{##1}{##2}}
\def\All##1##2##3{%
\Incr{}
\ThreeUnequalColumns{#1}{#2}{#3}{\arabic{ProtocolDialogStep}. ##1}{##2}{##3}
}
\def\Bob##1{\Incr{}\ThreeUnequalColumns{#1}{#2}{#3}{\relax}{\relax}{
\arabic{ProtocolDialogStep}. ##1}}%
\setcounter{ProtocolDialogStep}{0}%
\ThreeUnequalColumns{#1}{#2}{#3}{\textbf{Ref}}{\textbf{\ColorOne{Alice}}}{\textbf{\ColorTwo{Bob}}}
}{%
}
%% #1 -- options
%% #2 -- width
%% #3 -- height
%% #4 -- signals
\newenvironment{GateBox}[4][scale=1.0]{%
\edef\Signals{#4}%
\edef\Height{#3}%
\edef\Width{#2}%
\pgfmathsetmacro{\Max}{\Signals}%
\pgfmathsetmacro{\Vsep}{\Height / \Max}%
\pgfmathsetmacro{\Wlen}{\Width / 5}%
\def\ComputeMyY##1{%
   \pgfmathsetmacro{\MyY}{\Height - 0.5 * \Vsep - ##1*\Vsep}}%
\def\Input##1##2{%
   \pgfmathsetmacro{\Xone}{-\Wlen}
   \pgfmathsetmacro{\Xtwo}{0}
   \pgfmathsetmacro{\MyY}{\Height - 0.5 * \Vsep - ##1*\Vsep}
   \draw[->] (\Xone,\MyY) node[left] {##2} -- (\Xtwo,\MyY);
}%
\def\Output##1##2{%
   \pgfmathsetmacro{\Xone}{\Width}
   \pgfmathsetmacro{\Xtwo}{\Width + \Wlen}
   \pgfmathsetmacro{\MyY}{\Height - 0.5 * \Vsep - ##1*\Vsep}
   \draw[->] (\Xone,\MyY) -- (\Xtwo,\MyY) node[right] {##2};
}%
\def\BoxLabel##1{%
\node[draw, fit={(0,0) (\Width,\Height)}, inner sep=0pt, label=center:\mbox{##1}] (A) {};
}%
\begin{TIKZP}[#1]
   \draw (0,0) rectangle(#2,#3);
}{%
\end{TIKZP}}
%%
%% 1 options
%% 2 width
%% 3 height
%% 4 number of qubits
%%
\newenvironment{DotPBox}[4][scale=1.0]{%
\edef\Qubits{#4}%
\edef\Height{#3}%
\edef\Width{#2}%
\pgfmathsetmacro{\Max}{\Qubits}%
\pgfmathsetmacro{\Hsep}{\Width / \Max}%
\def\Qbit##1##2{%
   \pgfmathsetmacro{\MyX}{##1*\Hsep}
   \draw (\MyX,0) rectangle ++(\Hsep,\Height) node[pos=0.5] {\ensuremath{##2}};
}%
\begin{TIKZP}[#1]
}{%
\end{TIKZP}}
\def\PhiTheta#1#2{%
\mbox{\ensuremath{\textcolor{\RCone}{\phi = #1}, \textcolor{\RCtwo}{\theta = #2}}}}
%
% #2 -- orcacle name
% #3 -- upper left input
% #4 -- lower left input
% #5 -- upper right output
% #6 -- lower right output
%
\newenvironment{Oracle}[6][scale=1.0]{%
\begin{GateBox}[#1]{2.5}{1.5}{2}
\BoxLabel{#2}
\Input{0}{#3}
\Input{1}{#4}
\Output{0}{#5}
\Output{1}{#6}
}{%
\end{GateBox}
}
\newenvironment{TTable}[3]{%
\def\TRow##1##2##3{%
##1 & ##2 & ##3 \\}
\begin{tabular}{c|cc}
\TRow{#1}{#2}{#3}\hline
}{%
\end{tabular}
}
%%
%%  1 name
%%  2 one x
%%  3 one f(x)
%%  4 another x
%%  5 another f(x)
\def\SBitTable#1#2#3#4#5{%
\begin{center}
    \begin{TTable}{#1}{$x$}{$f(x)$}
    \TRow{ }{#2}{#3}
    \TRow{ }{#4}{#5}
    \end{TTable}
\end{center}}
%%
%%
\newenvironment{UTable}[6]{%
\def\URow##1##2##3##4##5##6{%
##1 & ##2 & ##3  & ##4 & ##5 & ##6\\}
\begin{tabular}{c|cc|c|cc}
& \multicolumn{2}{|c|}{Inputs} &
& \multicolumn{2}{|c}{Outputs} \\
\URow{#1}{#2}{#3}{#4}{#5}{#6}\hline
}{%
\end{tabular}
}
%%
%%  1 name
%%  2 one x
%%  3 one f(x)
%%  4 another x
%%  5 another f(x)
\def\SBitTable#1#2#3#4#5{%
\begin{center}
    \begin{TTable}{#1}{$x$}{$f(x)$}
    \TRow{ }{#2}{#3}
    \TRow{ }{#4}{#5}
    \end{TTable}
\end{center}}

\newenvironment{BlochSphere}[3][scale=1.0]{
    \bgroup%
    \def\BlochSpherePhiTheta{%
    \tdplotsetrotatedcoords{0}{0}{0};O
        \path[tdplot_rotated_coords] (1.0,0,0) arc (0:115:1.0) node(phi) {};
        \draw[tdplot_rotated_coords,thick,\RCone] (0.3,0,0) arc (0:115:0.3);
        \draw[tdplot_rotated_coords,\RCone,thick,dashed] (0,0,0) -- (phi);
        \draw[\RCone] (0.4,0.4,0) node {$\phi$};
        
        \tdplotsetrotatedcoords{25}{-90}{0};
        \path[tdplot_rotated_coords] (1,0,0) arc (0:45:1) node(theta) {};
        \draw[tdplot_rotated_coords,thick,\RCtwo] (0.4,0,0) arc (0:45:0.4);
        \draw[tdplot_rotated_coords,\RCtwo,thick] (0,0,0) -- (theta);
        \draw[\RCtwo] (-0.4,0,0.3) node {$\theta$};
        
        
    }
    \def\TZPointDiam{0.7pt}%
    \def\ShowAxes{%
    \draw[dashed, tdplot_rotated_coords, black] (1,0,0) node {{\Large\bf x}} (0,1,0) node {{\Large\bf y}} (0,0,1) node {{\Large\bf z}};
    }%
    \tdplotsetmaincoords{#2}{#3}%
    \begin{tikzpicture}[tdplot_main_coords, #1]
        
        
        \shade[ball color = lightgray, opacity = 0.5] (0,0,0) circle (1cm);
        
        %%
        %% The equator
        %%
        \tdplotsetrotatedcoords{0}{0}{0};
        \draw[dashed, tdplot_rotated_coords, gray] (0,0,0) circle (1);
        
        %%
        %% Arc in the x-z plane
        %%
        \tdplotsetrotatedcoords{90}{90}{90};
        \draw[dashed, tdplot_rotated_coords, gray] (1,0,0) arc (0:180:1);
        
        %%
        %% Arc in the y-z plane
        %%
        \tdplotsetrotatedcoords{0}{90}{90};
        \draw[dashed, tdplot_rotated_coords, gray] (1,0,0) arc (0:180:1);
        
        %\tdplotsetrotatedcoords{90}{90}{90};
       % \draw[dashed, tdplot_rotated_coords, black] (1,0,0) node {{\Large\bf x}} (0,1,0) node {{\Large\bf y}} (0,0,1) node {{\Large\bf z}}; 
        
        \draw[dashed, gray] (0,0,0) -- (-1,0,0);
        \draw[dashed, gray] (0,0,0) -- (0,-1,0);
        \draw[dashed, gray] (0,0,0) -- (0,0,-1);
        
        \draw[-stealth] (0,0,0) -- (1.30,0,0);
        \draw (1.45,0,0) node[below left] {$x$};
        \draw[-stealth] (0,0,0) -- (0,1.30,0);
        \draw(0,1.45,0) node {$y$};
        \draw[-stealth] (0,0,0) -- (0,0,1.30);
        \draw (0,0,1.45) node {$z$};
        
}{%
    \end{tikzpicture}
    \tdplotsetmaincoords{0}{0}
    \egroup
}

\long\def\Exercise#1#2{%
\relax}
\newcommand\QEDsym[1][2em]{\hbox to #1{\hss\ensuremath{\square}}}
\def\QED{\begin{flushright}\ensuremath{\square}\end{flushright}}
\def\UGateA{%
\ensuremath{\cos(\theta/2)}}
\def\UGateB{%
\ensuremath{-\ExpPhase{\lambda}\sin(\theta/2)}}
\def\UGateC{%
\ensuremath{\ExpPhase{\phi}\sin(\theta/2)}}
\def\UGateD{%
\ensuremath{\ExpPhase{(\phi+\lambda)}\cos(\theta/2)}}
\def\UGate{%
\SQBG{\relax}{\UGateA{}}{\UGateB{}}{\UGateC{}}{\UGateD{}}}%
\def\FCirc#1{%
\begin{tikzpicture}[scale=#1]%
\SquareOutline{}%
\fill (0.5,0.5) circle(0.4);%
\end{tikzpicture}%
}%
\def\SCirc{\FCirc{0.3}}%
\def\CFCirc#1{%
  \textcolor{#1}{\FCirc{0.30}}}
\def\Agree{%
  \textcolor{green}{\FCirc{0.30}}}%
\def\DisAgree{%
   \textcolor{red}{\FCirc{0.30}}}%
\def\MetaAgree{%
   \textcolor{yellow}{\FCirc{0.30}}}%
\newenvironment{EKey}[0]{%
\def\ZZ{%
\ZRot{0}%
}%
\def\ZZPO##1{%
\ZRot{\frac{\pi}{##1}}%
}%
\def\ZZNPO##1{%
\ZRot{\ensuremath{\,-\frac{\pi}{##1}}}%
}%
\def\ZRot##1{%
\ensuremath{Z_{##1}}%
}%
}{%
}
\def\AltAlert#1#2#3{%
\alt<#1>{\alert{#2}}{#3}}
\def\RCone{Rhodamine}
\def\RCtwo{CornflowerBlue}
\def\RCthree{LimeGreen}
\def\RCfour{Tan}
\def\RCfive{Mulberry}%{Plum}
\def\RCsix{orange}
\def\ColorOne#1{\textcolor{\RCone}{#1}}
\def\ColorTwo#1{\textcolor{\RCtwo}{#1}}
\def\ColorThree#1{\textcolor{\RCthree}{#1}}
\def\ColorFour#1{\textcolor{\RCfour}{#1}}
\def\ColorFive#1{\textcolor{\RCfive}{#1}}
\def\ColorSix#1{\textcolor{\RCsix}{#1}}
\def\ColorBlack#1{\textcolor{black}{#1}}
\def\NegF#1{\NegOneExp{f(#1)}}
\def\NegOneExp#1{\ensuremath{(-1)^{#1}}}
\def\RootTwoN#1{\RootN{2^{#1}}}
%%
%% var, exponent
%%
\def\SumBV#1#2{\OpBV{#1}{#2}{\displaystyle\sum\limits}}
\def\OpBV#1#2#3{\ensuremath{#3_{\AllBits{#1}{#2}}}}
\def\DotP#1#2{\ensuremath{#1\boldsymbol{\cdot}#2}}
\def\SumPH#1#2{\displaystyle\sum\limits_{#1=0}^{2^{#2}-1}}
%
% for hadamard results
%
%% #1 w for H((w>)
%% #2 free variable name
%% #3 n
\newcounter{HTableCounter}
\newenvironment{HTable}[3]{%
%% ##1 v^w
%% ##2 v . w
%% ##3 result
%% ##4 basis vector 000 001 etc.
\def\TE##1##2##3##4{%
\ensuremath{##4} & \ensuremath{##1} & \ensuremath{##2} & \ensuremath{##3 1} \ensuremath{\ket{##4}}}%
\begin{tabular}{c|c|c|r}
\multicolumn{4}{c}{$\sqrt{2^{#3}}$\,\Hadamard(\ket{#1})} \\ 
$v$ & \And{v}{#1} & \DotP{v}{#1} &  \multicolumn{1}{|c}{Term} \\ \hline}{%
\end{tabular}
}

\newcounter{ScrollCounter}
\newcounter{ScrollCounterEnd}
\newcounter{ScrollEOne}
\newcounter{ScrollETwo}
\newcounter{ScrollEThree}
\newcounter{ScrollEFour}
%%
%% start
%%
\newenvironment{ScrollingProof}[1][1]{%
   \setcounter{ScrollCounter}{#1}%
   \setcounter{ScrollEOne}{#1}%
   \setcounter{ScrollETwo}{#1}%
      \stepcounter{ScrollETwo}%
   \setcounter{ScrollEThree}{#1}%
      \stepcounter{ScrollEThree}\stepcounter{ScrollEThree}%
   \setcounter{ScrollEFour}{#1}%
      \stepcounter{ScrollEFour}\stepcounter{ScrollEFour}\stepcounter{ScrollEFour}
   \def\Curr{\value{ScrollCounter}}%
   \def\One{\value{ScrollEOne}}%
   \def\Two{\value{ScrollETwo}}%
   \def\Three{\value{ScrollEThree}}%
   \def\Four{\value{ScrollEFour}}%
   %\def\Memo##1{\gdef\RCScrollMemoText{##1}##1}
   %\def\Recall{\RCScrollMemoText}
   \def\Next##1##2{%
       \visible<\value{ScrollCounter}-##1>{##2}%
       %\def\Last{##2}%
    \stepcounter{ScrollCounter}%
    \stepcounter{ScrollEOne}%
    \stepcounter{ScrollETwo}%
    \stepcounter{ScrollEThree}%
    }%
    \def\Last##1{%
        \gdef\ScrollingLastText{##1}%
        \Next{\Two}{\visible<\value{ScrollETwo}>{\alert{\ensuremath{\big\Uparrow}}\ }##1}}%
}{%
}
\long\def\ScrollProof#1#2#3{%
\only<#1-#2>{%
\begin{ScrollingProof}[#1]
\begin{align*}
#3
\end{align*}
\end{ScrollingProof}}}
\def\RVDots{\raisebox{0.5em}{\ensuremath{\vdots}}}
%%
%% #1 -- the state undergoing hadamard
%% #2 -- the number of bits
%% #3 -- the free variable
\def\NHadamard#1#2#3{%
\SumBV{#3}{#2} \NegOneExp{\DotP{#1}{#3}} \ket{#3}}
\newenvironment{Reasoning}{%
\def\Reason##1##2{%
   \only<##1>{\makebox(0,0)[l]{\alert<##1>{\textit{##2}}}}}%
%%
%% #1 -- the range for overlays
%% #2 -- the color
%% #3 -- x
%% #4 -- y
%% #5 -- width
%% #6 -- height
%%
\def\CallOut##1##2##3##4##5##6{%
    \Reason{##1}{\Highlight{##2}{##3}{##4}{##5}{##6}}}
\vrule width 0pt depth 0.5em height 0.5em}{%
}
\def\Span#1{\ensuremath{{\mbox{span}(#1)}}}
\def\EmptySet{\Set{\,}}
%%
%% Large Binary Point
%%
\def\LBP{\mbox{\Huge .\hskip -1pt}}
%%
%% #1 color
%% #2 x loc
%% #3 y loc
%% #4 width
%% #5 height
\def\Highlight#1#2#3#4#5{%
\begin{tikzpicture}[overlay]
\draw[fill=#1,opacity=0.2] (#2,#3) rectangle ++(#4,#5);
\end{tikzpicture}}
\def\Indent#1{\mbox{}\hbox to #1{\hss}}
\newenvironment{ReverseDiag}[1][scale=1.0]{%
%%
%% ##1 color
%% ##2 location
%%
\def\BallRadius{0.45}
\def\BBall##1##2{\fill[##1,fill opacity=0.7] ##2 circle(\BallRadius);}
\begin{TIKZP}[#1]
    \draw[thick,draw=black,fill=gray, fill opacity=0.2] (0,0) -- ++(2,0) -- ++(0.5,-0.5) -- ++(0,-3) -- ++(-2.0,0) -- ++(-0.5,0.5) -- cycle;
    \draw[thick,draw=black,fill=gray] (0.5,0) -- ++(0,1)  -- node[above right,pos=0.5] {1-in} ++(1,0) -- ++(0,-1) -- cycle;
    \draw[thick,draw=black,fill=gray] (0,-0.7) -- ++(-1,0)  -- node[below left] {0-in} ++(0,-1) -- ++(1,0) -- cycle;
    \draw[thick,draw=black,fill=gray] (0.5,-3.5) -- ++(0,-1) -- ++(1.5,0) node[below right,pos=0.5] {1-out} -- ++(0,1) -- cycle;
    \draw[thick,draw=black,fill=gray] (2.5,-0.7) -- ++(1,0) -- ++(-0,-0.9) node[right] {0-out}-- ++ (-1,0) -- cycle;
    \draw[thick,draw=black,fill=\RCfour] (2.5,-1.75) -- ++(1,0) -- ++(-0,-1) node[right] {AND-out}-- ++ (-1,0) -- cycle;

}{%
\end{TIKZP}
}
\newenvironment{Pixture}[3][width=1.0\textwidth]{%
\begin{TIKZP}
\node at (0,0)
    {\includegraphics[#1]{#2/#3}}; 
}{%
\end{TIKZP}
}
\def\KetBra#1#2{\ensuremath{\ket{#1}\kern-3pt\bra{#2}}}

\newcounter{TDIi}
\newcounter{TDIj}
%%
%% #1 -- the upper bound on the inner loop before incrementing the outer
%%
\newenvironment{TDIter}[1]{%
\setcounter{TDIi}{1}%
\setcounter{TDIj}{1}%
\def\TDINext{%
   \stepcounter{TDIj}%
   \ifnum\value{TDIj}>#1%
      \setcounter{TDIj}{1}%
      \stepcounter{TDIi}%
   \else\fi}%
}{%
}
%%
%% This is driven by calls to \TE which cycle through the
%% matrix entries.
%%
%% #1 -- how many rows and columns
%% #2 -- i, the first row
%% #3 -- j, the second row
%% #4 --  ii
%% #5 --  ij
%% #6 --  ji
%% #7 --  jj
%% #8 -- default diagonal value
%% #9 -- default off-diagonal value
%%
\newenvironment{TLArray}[9]{%
\def\II##1{\ColorOne{##1}}\def\IJ##1{\ColorTwo{##1}}\def\JI##1{\ColorTwo{##1}}\def\JJ##1{\ColorOne{##1}}\def\DD##1{##1}\def\OD##1{##1}
\def\GenFourByFour{%
\TE  & \TE & \TE & \TE \\
\TE  & \TE & \TE & \TE \\
\TE  & \TE & \TE & \TE \\
\TE  & \TE & \TE & \TE}%
\begin{TDIter}{#1}
\def\TE{%
%%
%%
\ifnum\value{TDIi}=\value{TDIj}%
%%
%%  diagonal
    \ifnum\value{TDIi}=#2\relax%
       \II{#4}%
    \else%
       \ifnum\value{TDIi}=#3\relax%
          \JJ{#7}%
       \else%
          \DD{#8}%
       \fi
    \fi
%%  off diag
\else
    \ifnum\value{TDIi}=#2\relax%
       \ifnum\value{TDIj}=#3\relax%
          \IJ{#5}%
       \else%
           \OD{#9}%
       \fi
    \else
       \ifnum\value{TDIj}=#2\relax%
          \ifnum\value{TDIi}=#3\relax%
             \JI{#6}%
          \else%
             \OD{#9}%
          \fi%
       \else%
          \OD{#9}%
       \fi%
    \fi%
\fi%
\TDINext{}
}%
}{%
\end{TDIter}
}
%%
%%  #1 -- how many rows and columns
%%  #2 -- i coordinate to call out
%%  #3 -- j coordinate to call out
%%  #4 -- command to spotlight
%%  #5 -- command for top row entry
%%  #6 -- top row number
%%
\newenvironment{SpotArray}[6]{%
\begin{TDIter}{#1}
\def\TE##1{%
   \ifnum\value{TDIj}=#3\relax%      column
      \ifnum\value{TDIi}=#2\relax%   row
           #4{##1}%
       \else%
          \ifnum\value{TDIi}=#6\relax%  top row
             #5{##1}
          \else%
             ##1
          \fi%
       \fi
    \else%
       ##1%
    \fi%
    \TDINext{}
}%
}{%
\end{TDIter}
}
\def\ZeroMatrix{\ensuremath{\mathbf{0}}}

\newenvironment{MPSquareEnv}{%
\def\MPC##1{\fbox{\hbox to 6ex{\hss\mbox{##1}\vrule width 0pt height 3ex depth 2ex\hss}}}
\def\XP##1{\hbox to 2ex{\hss##1\hss 1}}%
\def\PP{%
\XP{$+$}}%
\def\MM{%
\XP{$-$}}%
\def\TpLf##1{##1}%
\def\TpCt##1{##1}%
\def\TpRt##1{##1}%
\def\MdLf##1{##1}%
\def\MdCt##1{##1}%
\def\MdRt##1{##1}%
\def\BtLf##1{##1}%
\def\BtCt##1{##1}%
\def\BtRt##1{##1}%
\def\MPSquare##1##2##3##4##5##6##7##8##9{%
{%
    \setlength{\tabcolsep}{0pt}%
    \adjustbox{valign=t}{\begin{tabular}{rrccc}
   \multicolumn{1}{c}{ } & \multicolumn{1}{c}{ } & \multicolumn{3}{c}{$\downarrow\ $\ColorTwo{Bob}$\ \downarrow$} \\
    & & 1 & 2 & 3 \\
        $\rightarrow\ $ & \ 1\ \ & \MPC{\TpLf{##1}} & \MPC{\TpCt{##2}} & \MPC{\TpRt{##3}} \\
        \mbox{\ColorOne{Alice} }& \ 2\ \ & \MPC{\MdLf{##4}} & \MPC{\MdCt{##5}} & \MPC{\MdRt{##6}} \\
        $\rightarrow\ $&\ 3\ \ & \MPC{\BtLf{##7}} & \MPC{\BtCt{##8}} & \MPC{\BtRt{##9}} \\
    \end{tabular}}}}%
\def\TP##1##2{{\mbox{\small\TensProd{##1}{##2}}}}%
\def\MyMarkupSquareComp##1{##1}
\def\MyMarkupSquareI##1{##1}
\def\MPSoln{%
    \MPSquare{\TP{\PauliZ}{\MyMarkupSquareI{\Identity}}}{\TP{\MyMarkupSquareI{\Identity}}{\PauliZ}}{\TP{\PauliZ}{\PauliZ}}{\TP{\MyMarkupSquareI{\Identity}}{\PauliX}}{\TP{\PauliX}{\MyMarkupSquareI{\Identity}}}{\TP{\PauliX}{\PauliX}}{\MyMarkupSquareComp{\Not{\TP{\PauliZ}{\PauliX}}}}{\MyMarkupSquareComp{\Not{\TP{\PauliX}{\PauliZ}}}}{\TP{\PauliY}{\PauliY}}}
}{%
}
\def\Alice{\ColorOne{Alice}}
\def\Bob{\ColorTwo{Bob}}

%%
%% Thanks, stackexchange
%%
\newlength\stextwidth
\newcommand\MakeSameWidth[3][c]{%
  \settowidth{\stextwidth}{#2}%
  \makebox[\stextwidth][#1]{#3}%
}
\newenvironment{MPbasis}[3]{%
\def\AltA{\QState{0}}
\def\AltB{\QState{1}}
\def\AltC{\QState{2}}
\def\AltD{\QState{3}}
\def\XP##1{\hbox to 3ex{\hss##1\hss 1}}%
\def\PP{%
\XP{$+$}}%
\def\MM{%
\XP{$-$}}%
\def\Col##1##2##3##4{\ensuremath{\begin{matrix*}[r] ##1\\##2\\##3\\##4\end{matrix*}}}
\def\Row##1##2##3{\ensuremath{##1} & \ensuremath{##2} & \ensuremath{##3}}
%%
%%  The eigenvalues associated with measurements
%%
\def\Eigs{%
  \begin{center}
  \begin{tabular}{c|ccc}
      & #1 & #2 & #3 \\\hline
      \ColorThree{\QState{0}} & \visible<2->{\EigA} \\
      \ColorFour{\QState{1}} & \visible<3->{\EigB} \\
      \ColorFive{\QState{2}} & \visible<4->{\EigC} \\
      \ColorSix{\QState{3}} & \visible<5->{\EigD} \\
   \end{tabular}\end{center}
}%
%%
%% The eigenstates basis
%%
\def\Bases##1{%
\adjustbox{valign=t}{\ensuremath{T=##1\ \begin{blockarray}{cccc}
\alert{\ket{00}} & \alert{\ket{01}} &\alert{\ket{10}} &\alert{\ket{11}} \\
\ColorThree{\alt<1>{\MakeSameWidth{\AltA}{\QState{0}}}{\AltA}} & \ColorFour{\alt<1-2>{\MakeSameWidth{\AltB}{\QState{1}}}{\AltB}} & \ColorFive{\alt<1-3>{\MakeSameWidth{\AltC}{\QState{2}}}{\AltC}} & \ColorSix{\alt<1-4>{\MakeSameWidth{\AltD}{\QState{3}}}{\AltD}} \\
\begin{block}{(cccc)}
\visible<2->{\ColorThree{\A}} & \visible<3->{\ColorFour{\B}} & \visible<4->{\ColorFive{\C}} & \visible<5->{\ColorSix{\D}}\\\end{block}\end{blockarray}}}%
}
}{%
}
\def\MPCircuit{%
\begin{quantikz} 
\qw & \gate[wires=2]{\mbox{$\Conj{T}$}} & \qw & \meter{\alert{0\,/\,1}} & \qw & \\
\qw & \qw & \qw & \meter{\alert{0\,/\,1}} & \qw 
\end{quantikz}
}%
\newenvironment{MPScene}{%
\def\Aone{\ColorSix{\mbox{$a_1$}}}\def\AoneColor{\ColorSix}
\def\Atwo{\ColorThree{\mbox{$a_2$}}}\def\AtwoColor{\ColorThree}
\def\Bone{\ColorFour{\mbox{$b_1$}}}\def\BoneColor{\ColorFour}
\def\Btwo{\ColorFive{\mbox{$b_2$}}}\def\BtwoColor{\ColorFive}
\def\IColor{\ColorBlack}
\def\Ambig##1{\Ovalbox{\ensuremath{##1}}}
\def\Answer##1{\mbox{\Large\ensuremath{##1}}}
\def\Report##1{Report \ensuremath{##1}}
\def\ReportCommon##1{\textbf{\alert{Report}} \ensuremath{##1}}
}{%
}
\def\MATLAB{\texttt{MATLAB}}
\def\SMod#1{\mbox{\small\ \ColorThree{(mod $#1$)}}}
\def\SGCD#1#2{\ensuremath{\mbox{gcd}}(#1,#2)}

